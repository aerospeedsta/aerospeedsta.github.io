{{ define "main" }}
<article class="post-single">
    <!-- Project Header -->
    <header class="post-header">
        <div class="breadcrumbs">
            <a href="{{ "" | absLangURL }}">Home</a>&nbsp;»&nbsp;<a href="{{ " projects" | absLangURL }}">Projects</a>
        </div>
        <h1 class="post-title">{{ .Title }}</h1>
        <div class="post-meta">
            <span title="{{ .Date.Format " 2006-01-02 15:04:05 -0700 MST" }}">
                {{ .Date.Format "January 2, 2006" }}
            </span>&nbsp;·&nbsp;{{ .ReadingTime }} min
        </div>
    </header>

    <!-- Tag Pills -->
    <div class="post-tags" style="margin-bottom: 20px;">
        {{- partial "tag_pills.html" . }}
    </div>

    <!-- Abstract Box -->
    {{- if or .Params.abstract .Description }}
    <div class="abstract-box"
        style="background: var(--entry); padding: 20px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin: 25px 0;">
        <h3
            style="margin-top: 0; margin-bottom: 10px; font-size: 1.1rem; color: var(--primary); text-transform: uppercase; letter-spacing: 1px;">
            Abstract</h3>
        <div style="color: var(--secondary); font-style: italic; line-height: 1.6;">
            {{ .Params.abstract | default .Description | markdownify }}
        </div>
    </div>
    <hr style="border: 0; border-top: 1px solid var(--border); margin: 40px 0;">
    {{- end }}

    <!-- Cover Image -->
    {{- $isHidden := .Params.cover.hidden | default false }}
    {{- partial "cover.html" (dict "cxt" . "IsSingle" true "isHidden" $isHidden) }}

    <!-- Content -->
    <div class="post-content">
        {{ .Content }}
    </div>

    <footer class="post-footer">
    </footer>

    <!-- Associated Research Updates (Blog Posts) -->
    {{ $projectId := .Params.project_id }}
    {{ if $projectId }}
    {{ $relatedPosts := where site.RegularPages "Params.project_id" $projectId }}
    {{ $relatedPosts := where $relatedPosts "Permalink" "!=" .Permalink }}
    {{ if gt (len $relatedPosts) 0 }}
    <div class="project-updates" style="margin-top: 60px; padding-top: 20px; border-top: 1px solid var(--border);">
        <h2 style="margin-bottom: 30px; font-size: 1.8rem;">Research Updates</h2>
        <div style="display: flex; flex-direction: column; gap: 20px;">
            {{ range $relatedPosts }}
            <article class="post-entry">
                <header class="entry-header">
                    <h2>{{ .Title }}</h2>
                </header>
                <div class="entry-content">
                    <p>{{ .Summary | plainify | htmlUnescape }}{{ if .Truncated }}...{{ end }}</p>
                </div>
                <footer class="entry-footer">
                    <span title="{{ .Date.Format " 2006-01-02 15:04:05 -0700 MST" }}">
                        {{ .Date.Format "January 2, 2006" }}
                    </span>&nbsp;·&nbsp;{{ .ReadingTime }} min
                </footer>
                <a class="entry-link" aria-label="post link to {{ .Title | plainify }}" href="{{ .Permalink }}"></a>
            </article>
            {{ end }}
        </div>
    </div>
    {{ end }}
    {{ end }}
</article>
{{ end }}